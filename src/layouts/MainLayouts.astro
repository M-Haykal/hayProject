---
import Navbar from "../components/sections/navbar.astro";
import Footer from "../components/sections/footer.astro";
import IntroAnimation from "../components/IntroAnimation.astro";
import Sidebar from "../components/sections/sidebar.astro";
import "../styles/global.css";
import { ViewTransitions } from "astro:transitions";
export interface Props {
  title: string;
}

const { title } = Astro.props;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/logo_hayproject.jpeg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <ViewTransitions />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>HayProject</title>
    <style>
      @keyframes floaty {
        0% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-6px);
        }
        100% {
          transform: translateY(0);
        }
      }

      @keyframes wigglecute {
        0%,
        100% {
          transform: rotate(0deg);
        }
        50% {
          transform: rotate(2deg);
        }
      }

      @keyframes popin {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      .material-symbols-outlined {
        font-variation-settings:
          "FILL" 0,
          "wght" 400,
          "GRAD" 0,
          "opsz" 24;
        font-size: 22px;
      }
      .syntax-keyword {
        color: #569cd6;
      }
      .syntax-string {
        color: #ce9178;
      }
      .syntax-property {
        color: #9cdcfe;
      }
      .syntax-comment {
        color: #6a9955;
      }
      .syntax-const {
        color: #4fc1ff;
      }
      .syntax-bracket {
        color: #ffd700;
      }
    </style>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-white overflow-hidden h-screen flex flex-col relative">
    <Navbar />
    <div class="flex flex-1 overflow-hidden">
      <Sidebar />
      <slot />
    </div>
    <Footer />

    <script>
      /* ======================================================
       * GLOBAL CONSTANTS
       * ====================================================== */
      const DEFAULT_FILE = "About.js";
      const TITLE_SUFFIX = "— HayProject — Visual Studio Code";
      const HIDDEN_CLASS = "hidden";

      /* ======================================================
       * DOM HELPERS
       * ====================================================== */
      const $tabs = () => document.querySelectorAll(".tab-item");
      const $pages = () => document.querySelectorAll(".page-content");
      const $breadcrumb = () => document.getElementById("breadcrumb");
      const $navbarTitle = () => document.getElementById("navbar-title");

      /* ======================================================
       * FILE STORE
       * ====================================================== */
      async function getFiles() {
        const { files } = await import("../scripts/files.js");
        return files;
      }

      async function setFileActive(fileName) {
        const module = await import("../scripts/files.js");
        module.setActiveFile(fileName);
      }

      /* ======================================================
       * NAVBAR
       * ====================================================== */
      async function updateNavbarTitle(fileName) {
        const files = await getFiles();
        const file = files[fileName];
        if (!file || !$navbarTitle()) return;

        $navbarTitle().textContent = `${file.title} ${TITLE_SUFFIX}`;
      }

      /* ======================================================
       * SIDEBAR
       * ====================================================== */
      function toggleExplorer() {
        const explorer = document.getElementById("explorer");
        explorer.classList.toggle("-translate-x-full");
      }

      window.setActiveFile = async function (fileName) {
        await setFileActive(fileName);

        window.dispatchEvent(
          new CustomEvent("activeFileChanged", {
            detail: { name: fileName },
          })
        );

        updateSidebarUI(fileName);
      };

      function updateSidebarUI(fileName) {
        document
          .querySelectorAll('[onclick^="setActiveFile"]')
          .forEach((item) => {
            const label = item.querySelector("span:last-child");
            const isActive = item.onclick.toString().includes(fileName);

            item.classList.toggle("bg-[#37373d]", isActive);
            item.classList.toggle("hover:bg-[#2a2d2e]", !isActive);

            label.classList.toggle("text-white", isActive);
            label.classList.toggle("text-gray-400", !isActive);
          });
      }

      /* ======================================================
       * TAB BAR
       * ====================================================== */
      const ACTIVE_TAB = [
        "bg-[#1e1e1e]",
        "border-t",
        "border-primary",
        "cursor-default",
      ];
      const INACTIVE_TAB = [
        "bg-[#2d2d2d]",
        "hover:bg-[#2a2d2e]",
        "cursor-pointer",
      ];

      function updateTabBarUI(activeFile) {
        $tabs().forEach((tab) => {
          const isActive = tab.dataset.file === activeFile;
          const title = tab.querySelector(".tab-title");

          ACTIVE_TAB.forEach((cls) => tab.classList.toggle(cls, isActive));
          INACTIVE_TAB.forEach((cls) => tab.classList.toggle(cls, !isActive));

          title.classList.toggle("text-white", isActive);
          title.classList.toggle("text-gray-400", !isActive);
        });

        window.activeFileName = activeFile;
      }

      async function updateBreadcrumbUI(fileName) {
        const files = await getFiles();
        const file = files[fileName];
        if (!file || !$breadcrumb()) return;

        $breadcrumb().innerHTML = "";

        file.path
          .split("/")
          .slice(0, -1)
          .forEach((part) => {
            $breadcrumb().append(createSpan(part), createChevron());
          });

        const wrapper = document.createElement("div");
        wrapper.className = "flex items-center gap-1";

        const icon = document.createElement("i");
        icon.className = `fa-brands fa-${file.icon} !text-[14px] ${file.iconColor}`;

        const title = document.createElement("span");
        title.className = "text-gray-300";
        title.textContent = file.title;

        wrapper.append(icon, title);
        $breadcrumb().append(wrapper);
      }

      function createSpan(text) {
        const span = document.createElement("span");
        span.textContent = text;
        return span;
      }

      function createChevron() {
        const icon = document.createElement("span");
        icon.className = "material-symbols-outlined !text-[14px]";
        icon.textContent = "chevron_right";
        return icon;
      }

      /* ======================================================
       * TAB EVENTS
       * ====================================================== */
      function bindTabEvents() {
        $tabs().forEach((tab) => {
          const fileName = tab.dataset.file;

          tab.addEventListener("click", () => activateTab(fileName));

          tab.querySelector(".tab-close")?.addEventListener("click", (e) => {
            e.stopPropagation();
            closeTab(tab);
          });
        });
      }

      function activateTab(fileName) {
        window.setActiveFile(fileName);
        updateTabBarUI(fileName);
        updateBreadcrumbUI(fileName);
      }

      function closeTab(tab) {
        if ($tabs().length <= 1) return;

        const fileName = tab.dataset.file;
        tab.remove();

        if (fileName === window.activeFileName) {
          const next = $tabs()[0];
          if (next) activateTab(next.dataset.file);
        }
      }

      /* ======================================================
       * PAGE CONTENT
       * ====================================================== */
      function hideAllPages() {
        $pages().forEach((p) => p.classList.add(HIDDEN_CLASS));
      }

      function showPage(name) {
        document
          .querySelector(`[data-page="${name}"]`)
          ?.classList.remove(HIDDEN_CLASS);
      }

      async function updateContent(fileName) {
        const files = await getFiles();
        const file = files[fileName];
        if (!file) return;

        hideAllPages();
        showPage(file.content);
      }

      /* ======================================================
       * GLOBAL EVENTS
       * ====================================================== */
      window.addEventListener("activeFileChanged", (e) => {
        const name = e.detail.name;

        updateNavbarTitle(name);
        updateSidebarUI(name);
        updateTabBarUI(name);
        updateBreadcrumbUI(name);
        updateContent(name);
      });

      document.addEventListener("DOMContentLoaded", () => {
        updateNavbarTitle(DEFAULT_FILE);
        updateSidebarUI(DEFAULT_FILE);
        updateTabBarUI(DEFAULT_FILE);
        updateBreadcrumbUI(DEFAULT_FILE);
        updateContent(DEFAULT_FILE);
        bindTabEvents();
      });
    </script>
  </body>
</html>
